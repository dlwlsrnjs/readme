# CO2 배출량 예측 모델 개발 전략

## 1. 데이터 전처리 및 특성 선택 방법

### 1.1 데이터 구조
- **학습 데이터**: 22,176개 시계열 데이터 → 154개 일별 샘플로 집계
- **테스트 데이터**: 9,504개 시계열 데이터 → 66개 일별 샘플로 집계
- **특성 수**: 원본 30개 → 특성 엔지니어링 후 301개

### 1.2 시간 특성 엔지니어링
- **순환 특성 생성**: 시간의 주기성을 반영하기 위해 sin/cos 변환 적용
  - `hour_sin`, `hour_cos`: 24시간 주기 반영
  - `minute_sin`, `minute_cos`: 60분 주기 반영

### 1.3 환경 상호작용 특성
- **온습도 상호작용**: `temp_hum_interaction = in_temp × in_hum`
- **온도-CO2 상호작용**: `temp_co2_interaction = in_temp × in_co2`
- **습도-CO2 상호작용**: `hum_co2_interaction = in_hum × in_co2`

### 1.4 제어 시스템 특성
- **창문 평균**: `window_avg = (window1 + window2) / 2`
- **커튼 평균**: `curtain_avg = (curtain1 + curtain2 + curtain3) / 3`
- **제어 활성화도**: `control_activity = fan + co2 + heater + window_avg/100 + curtain_avg/100`

### 1.5 외부 환경 영향
- **온도 차이**: `temp_diff = in_temp - out_temp`
- **습도 차이**: `hum_diff = in_hum - out_hum`
- **일사량 제곱**: `solar_rad_squared = solar_rad²`

### 1.6 일별 통계 특성
각 샘플(1일)에 대해 모든 수치 특성의 통계값 계산:
- **기본 통계**: mean, std, min, max, range
- **시간대별 특성**: 주간(6-18시), 야간(18-6시) 평균값

## 2. 모델 아키텍처 및 주요 하이퍼파라미터

### 2.1 모델 선택: CatBoost Regressor
- **선택 이유**: 범주형 특성 처리 능력, 과적합 방지, 빠른 학습 속도
- **장점**: 자동 특성 선택, 순열 중요도 제공, 노이즈에 강함

### 2.2 최적 하이퍼파라미터 (교차검증 결과)
```python
{
    'iterations': 1000,           # 트리 개수
    'learning_rate': 0.05,        # 학습률 (낮게 설정하여 안정성 확보)
    'depth': 6,                   # 트리 깊이 (과적합 방지)
    'l2_leaf_reg': 3.0,           # L2 정규화 (3.0으로 설정)
    'random_strength': 0.1,       # 랜덤성 강도
    'random_state': 42,           # 재현성 확보
    'early_stopping_rounds': 50   # 조기 종료
}
```

## 3. 성능 향상 및 과적합 방지 전략

### 3.1 교차검증 기반 모델 선택
- **K-Fold 교차검증**: 5 folds, 3 repeats (총 15회 검증)
- **최적 설정 선택**: 가장 낮은 RMSE를 보인 설정 선택
- **성능**: 평균 Validation RMSE 1.8336 ± 0.2334, R² 0.8461 ± 0.0543
- **최고 성능**: Repeat 3, Fold 1에서 RMSE 1.5032 달성

### 3.2 과적합 방지 기법
1. **L2 정규화**: `l2_leaf_reg=3.0`으로 설정
2. **트리 깊이 제한**: `depth=6`으로 얕은 트리 사용
3. **조기 종료**: `early_stopping_rounds=50`으로 검증 성능 기반 조기 종료
4. **랜덤성 도입**: `random_strength=0.1`로 다양성 확보

### 3.3 특성 스케일링
- **StandardScaler**: 모든 특성을 평균 0, 표준편차 1로 정규화
- **일관성 확보**: 학습과 추론 시 동일한 스케일러 사용
- **하드코딩된 스케일러**: 301개 특성의 평균값과 표준편차를 코드에 직접 포함

## 4. 고유 전략 및 설명

### 4.1 음수 값 처리 전략
- **학습 시**: 음수 값을 그대로 사용하여 모든 패턴 학습
- **예측 시**: 음수 값도 예측 가능하도록 허용
- **이유**: 스마트팜에서 CO2 흡수(음수)와 배출(양수) 모두 발생 가능

### 4.2 시간적 특성 활용
- **순환 특성**: 시간의 주기성을 정확히 반영
- **주/야간 구분**: 식물의 광합성 활동 차이 반영
- **일별 집계**: 1일 단위로 통계 특성 계산하여 안정성 확보

### 4.3 환경 상호작용 모델링
- **다변량 상호작용**: 온도, 습도, CO2 간의 복합적 영향 반영
- **제어 시스템 통합**: 팬, CO2 공급, 히터, 창문, 커튼의 통합적 영향 모델링

### 4.4 성능 검증
- **공식 평가 지표 사용**: 경진대회에서 제공한 RMSE, R² 함수와 완전히 동일한 코드 사용
- **재현성 확보**: random_state 설정으로 일관된 결과 보장

## 5. 최종 모델 성능

### 5.1 학습 성능
- **최종 모델 RMSE**: 0.0006 (거의 완벽한 학습)
- **최종 모델 R²**: 1.0000 (완벽한 설명력)
- **저장 파일**: `model.pkl`, `model_scaler.pkl`

### 5.2 추론 성능
- **예측 샘플 수**: 66개
- **예측값 범위**: 0.9238 ~ 1.7074
- **예측값 평균**: 1.2749
- **예측값 표준편차**: 0.2102
- **음수 값**: 0개 (현재 테스트 데이터에서는 음수 값이 예측되지 않음)

### 5.3 모델 안정성
- **Sample_Number 범위**: 6 ~ 219 (연속적이지 않음)
- **중복 검증**: 중복 없음
- **NaN 값**: 없음
- **데이터 무결성**: 완벽함 
